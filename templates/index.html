<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dubai Grocery Price Comparator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <!-- Header Section -->
    <div class="header-section">
        <h1>Dubai Grocery Price Comparator</h1>
        <p class="subtitle">Compare SKUs across Carrefour, Noon & Talabat by price and weight/volume</p>

        <div class="search-box" style="margin-top: 20px;">
            <input type="text" id="searchInput"
                placeholder="Enter grocery item (e.g., bayara moong dal, milk, basmati rice)..."
                onkeypress="if(event.key==='Enter') searchGrocery()">
            <button id="searchBtn" onclick="searchGrocery()">Search</button>
        </div>

        <div class="preload-status" id="preloadStatus">
            <div class="store-status status-loading" id="status-carrefour">
                <div class="spinner"></div>
                <span>Carrefour: Loading...</span>
            </div>
            <div class="store-status status-loading" id="status-noon">
                <div class="spinner"></div>
                <span>Noon: Loading...</span>
            </div>
            <div class="store-status status-ready" id="status-talabat">
                <span>Talabat: Ready</span>
            </div>
        </div>

        <div class="loading" id="loading">Searching stores...</div>
        <div class="loading" id="matchingLoading" style="display: none;">Matching SKUs with AI...</div>
        <div id="error"></div>
    </div>

    <!-- Main App Layout -->
    <div class="app-layout">
        <!-- Main Results Column -->
        <div class="main-column" id="mainColumn">

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="section-title">Matched Results</h2>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <!-- New Sort Dropdown -->
                    <select id="sortOptions" onchange="matchProducts()"
                        style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="price_asc">Price: Low to High</option>
                        <option value="price_desc">Price: High to Low</option>
                        <option value="name_asc">Name: A to Z</option>
                        <option value="name_desc">Name: Z to A</option>
                    </select>

                    <button id="toggleRawBtn" class="toggle-raw-btn" onclick="toggleRawResults()"
                        style="display: none; font-size: 14px; padding: 6px 12px; border: 1px solid #ddd; border-radius: 6px;">
                        Show Raw Results Sidebar ➡️
                    </button>
                </div>
            </div>

            <div id="matchedResults"></div>
        </div>

        <!-- Raw Results Sidebar -->
        <div class="raw-sidebar" id="rawSection">
            <div class="section-header">
                <div class="section-title">Raw Store Results</div>
            </div>
            <div class="matched-note" id="locationNote"></div>
            <div id="rawResults" style="display: flex; flex-direction: column; gap: 16px;"></div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>